
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de Rastreio - Loja Amandita</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fdfdfd;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h2 {
      color: #f90302;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    textarea {
      width: 100%;
      height: 300px;
      margin-top: 20px;
      padding: 10px;
      font-size: 14px;
    }
    #copiar {
      background-color: #8FBFB1;
      color: white;
      border: none;
      cursor: pointer;
    }
    #enviar {
      background-color: #3E5650;
      color: white;
      border: none;
      cursor: pointer;
    }
    #qrcode {
      margin-top: 30px;
      text-align: center;
    }
    #qrcode img {
      width: 200px;
      height: 200px;
    }
  </style>
</head>
<body>
  <h2>Painel de Envio - Loja Amandita</h2>

  <button onclick="carregarPedidos()">üîÑ Carregar Pedidos da Shopify</button>
  <select id="listaPedidos" onchange="preencherCampos()">
    <option selected disabled>Selecione um pedido...</option>
  </select>

  <label for="nome">Nome do Cliente:</label>
  <input type="text" id="nome" placeholder="Ex: Maria Silva">

  <label for="telefone">Telefone do Cliente (com DDI):</label>
  <input type="text" id="telefone" placeholder="Ex: 5591999999999">

  <label for="codigo">C√≥digo de Rastreio:</label>
  <input type="text" id="codigo" placeholder="Ex: AB123456789BR">

  <button onclick="gerarMensagem()">Gerar Mensagem</button>
  <button id="copiar" onclick="copiarMensagem()">üìã Copiar Mensagem</button>
  <button id="enviar" onclick="enviarMensagem()">üì§ Enviar via WhatsApp</button>

  <textarea id="mensagem" readonly placeholder="A mensagem aparecer√° aqui..."></textarea>

  <div id="qrcode">
    <h3>Conecte seu WhatsApp</h3>
    <p>Escaneie o QR Code abaixo com seu WhatsApp para ativar o envio autom√°tico:</p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://wa.me/5591999999999&size=200x200" alt="QR Code WhatsApp">
    <p style="font-size: 14px; color: gray;">(QR code simulado - substitua pelo gerado pela API real ex: Z-API ou Venom)</p>
  </div>

  <script>
    let pedidosShopify = [];

    function carregarPedidos() {
      fetch('http://localhost:3000/pedidos-shopify')
        .then(res => res.json())
        .then(data => {
          pedidosShopify = data;
          const lista = document.getElementById('listaPedidos');
          lista.innerHTML = '<option selected disabled>Selecione um pedido...</option>';
          data.forEach((pedido, i) => {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `${pedido.nome} (${pedido.telefone || 'sem telefone'})`;
            lista.appendChild(option);
          });
          alert('Pedidos carregados com sucesso! ‚úÖ');
        })
        .catch(err => {
          console.error(err);
          alert('Erro ao carregar pedidos da Shopify ‚ùå');
        });
    }

    function preencherCampos() {
      const i = document.getElementById('listaPedidos').value;
      const pedido = pedidosShopify[i];
      document.getElementById('nome').value = pedido.nome || '';
      document.getElementById('telefone').value = pedido.telefone || '';
    }

    function gerarMensagem() {
      const nome = document.getElementById('nome').value;
      const codigo = document.getElementById('codigo').value;

      const mensagem = `Ol√° ${nome}! Tudo bem? Aqui √© da Loja Amandita üíñ\n` +
        `Estamos passando para te informar que o seu pedido j√° foi enviado com sucesso! ‚ú®üöõ\n` +
        `Segue abaixo o seu c√≥digo de rastreio para voc√™ acompanhar cada etapa da entrega:\n\n` +
        `üì¶ ${codigo}\n\n` +
        `Rastrei seu pedido em tempo real pela transportadora:\nüîó https://logirastro.com/\n\n` +
        `‚ö†Ô∏è Aten√ß√£o importante:\n` +
        `Fique atenta(o) a tentativas de golpe!\n` +
        `N√≥s, da Loja Amandita, N√ÉO cobramos nenhuma taxa adicional ap√≥s a sua compra.\n` +
        `Se voc√™ receber qualquer mensagem, e-mail ou boleto pedindo pagamento para liberar o pedido, n√£o pague! √â golpe.\n\n` +
        `Em caso de d√∫vida, fale com a gente por aqui mesmo.\nObrigada por confiar na Loja Amandita! üíï`;

      document.getElementById('mensagem').value = mensagem;
    }

    function copiarMensagem() {
      const textarea = document.getElementById('mensagem');
      textarea.select();
      document.execCommand('copy');
      alert('Mensagem copiada com sucesso! ‚úÖ');
    }

    function enviarMensagem() {
      const telefone = document.getElementById('telefone').value;
      const texto = document.getElementById('mensagem').value;
      const url = 'https://api.z-api.io/instances/3E0E63705D62203FD08896870211A73F/token/CFEDC0CC689B43BD57F87E60/send-text';

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          phone: telefone,
          message: texto
        })
      })
      .then(response => response.json())
      .then(data => {
        alert('Mensagem enviada com sucesso! ‚úÖ');
      })
      .catch(error => {
        alert('Erro ao enviar a mensagem ‚ùå');
        console.error('Erro:', error);
      });
    }
  </script>
</body>
</html>
